(()=>{"use strict";function e(){return window.filtrySettings}function t(){const e=jQuery(".filtry__filter"),t=new URLSearchParams(window.location.search),o={};return e.each(((e,t)=>{(t.classList.contains("filtry__filter--checkbox")||t.classList.contains("filtry__filter--radio"))&&jQuery(t).find("input:checked").each(((e,t)=>{const n=t.dataset.taxonomy,r=t.value;n in o?o[n].push(r):o[n]=[r]}))})),t.has("paged")&&(o.paged=parseInt(t.get("paged"))),t.has("orderby")&&(o.orderby=t.get("orderby")),o}function o(t,o=!0){const n=new URLSearchParams,{is_taxonomy_page:r,taxonomy:i,term_slug:c}=e();for(const e of Object.keys(t)){let l=Array.isArray(t[e])?t[e]:[t[e]];o&&r&&i===e&&(l=l.filter((e=>e!==c))),0!==l.length&&n.set(e,l.join(","))}return n.toString()}function n(){const o=t(),{shop_page:n,is_taxonomy_page:r,taxonomy:i,term_slug:c}=e();return r?i in o&&-1!==o[i].indexOf(c)?window.location.href.split("?")[0]:(window.filtrySettings.is_taxonomy_page=!1,document.body.dispatchEvent(new CustomEvent("filtry.taxonomy.downgrade")),n):window.location.href.split("?")[0]}function r(e=!0){e?document.body.classList.add("filtry--loader-active"):document.body.classList.remove("filtry--loader-active")}function i(i,c=null,l=null){const a=jQuery("ul.products");if(0===a.length)return void console.error("Filtry: Could not find store products container");const s=e();r(!0),function(e,t={}){const o=n();0===e.length?window.history.pushState(t,"",o):window.history.pushState(t,"",`${o}?${e}`)}(i);const u=o(t(),!1);jQuery.ajax({url:`${s.rest_url}?${u}`,method:"GET",headers:{"X-WP-Nonce":s.rest_nonce},success:function(e){r(!1),jQuery(".filtry__filters").replaceWith(e.filters),jQuery(".woocommerce-result-count").replaceWith(e.result_count),"function"==typeof c?c(e):(jQuery(".filtry").replaceWith(e.filters),a.html(e.products),jQuery(".woocommerce-pagination").replaceWith(e.pagination))},error:function(e){r(!1),"function"==typeof l&&l(e)}})}function c(e){i(e,(e=>{jQuery("ul.products").html(e.products),jQuery(".woocommerce-result-count").replaceWith(e.result_count),jQuery(".woocommerce-pagination").replaceWith(e.pagination),1===e.max_page?jQuery(".filtry-infinity-load").hide():jQuery(".filtry-infinity-load").show(),window.scrollTo({top:100,behavior:"smooth"})}))}function l(e){e.preventDefault();const n=e.target.href,r=n.match(/\/page\/(\d+)/);let i=null;if(r)i=parseInt(r[1]);else if(n.split("?").length>1){const e=n.split("?")[1],t=new URLSearchParams(e);t.has("paged")?i=parseInt(t.get("paged")):t.has("page")&&(i=parseInt(t.get("page")))}if(Number.isNaN(i))return void console.error("Filtry: Could not determine page number");const l=t();l.paged=i,c(o(l))}function a(){const e=t();e.paged?e.paged=parseInt(e.paged)+1:e.paged=2,i(o(e),(e=>{jQuery("ul.products").append(e.products),e.current_page>=e.max_page&&jQuery(".filtry-lazy-load").hide()}))}function s(){document.body.classList.remove("filtry--show-popup");const r=t();"paged"in r&&delete r.paged;const i=o(r);!0===e().ajax?c(i):window.location.href=i.length>0?`${n()}?${i}`:n()}function u(){!1!==e().autosubmit&&(768>window.innerWidth&&!0===e().mobile_filters||s())}function d(){const{shop_page:t}=e();window.location.href=t}function y(){jQuery(this).closest(".filtry__filter").toggleClass("filtry__filter--hidden").find(".filtry__list").slideToggle()}function p(){document.body.classList.toggle("filtry--show-popup")}document.addEventListener("DOMContentLoaded",(()=>{jQuery(document.body).on("change",".filtry__toggleable input",u),jQuery(document.body).on("click",".filtry__reset",d),jQuery(document.body).on("click",".filtry__submit",s),jQuery(document.body).on("click",".filtry__filter--collapsable .filtry__filter-head",y),jQuery(document.body).on("click",".filtry__popup-close",p),jQuery(document.body).on("click",".filtry__popup-toggle",p),jQuery(document.body).on("click",".filtry__popup-back",p),jQuery(document.body).on("click",".filtry__mobile-reset",d),jQuery(document.body).on("click",".filtry__mobile-apply",s),!0===e().ajax&&jQuery(document.body).on("click",".woocommerce-pagination a",l),!0===e().ajax&&!0===e().infinity_load&&jQuery(document.body).on("click",".filtry-load-more",a)}))})();